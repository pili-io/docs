<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="keywords" content="QINIU, live, RTMP, HLS, M3U8, API, DOC" />
    <meta name="description" content="为开发者量身定制的直播云服务.">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Demo设备管理器文档</title>

    <link href="../stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="../stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />

    <script src="http://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
      <script src="../javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["shell"]);
        });
      </script>
  </head>

  <body class="v1">

    <header class="navbar navbar-default navbar-fixed-top" role="banner">
      <div class="navbar-header">
        <a href="../" class="navbar-brand">
          <img src="http://qgroup.qiniudn.com/qcasting-logo-small-t.png" />
        </a>
      </div>

      <nav role="navigation">
        <ul class="nav">
<!--           <li><a href="qgenius.com/qcasting/">首页</a></li>
          <li><a href="http://qgenius.github.io/qcasting-docs/v2/" target="_blank">开发文档</a></li> -->
        </ul>

          <div class="lang-selector">
                <a href="#" data-language-name="shell">shell</a>
          </div>
      </nav>
    </header>


    <a href="#" id="nav-button"><span>NAV<img src="../images/navbar.png" /></span></a>


    <div class="tocify-wrapper">
        <div class="lang-selector">
              <a href="#" data-language-name="shell">shell</a>
        </div>

        <div class="search"><input type="text" class="search" id="input-search" placeholder="Search"></div>
        <ul class="search-results"></ul>

      <div id="toc"></div>

    </div>

    <div class="page-wrapper">

      <div class="content">
        
          <h1 id='zong-shu'>综述</h1>
<p>本方案用于视频流服务结合云存储提供7x24小时在线视频直播和点播的方案。</p>

          <h1 id='an-quan-gui-fan'>安全规范</h1><h2 id='jie-kou-jian-quan'>接口鉴权</h2>
<p>登录时获得的<code class="prettyprint">access_token</code>，以如下方式加入HTTP Header：</p>

<p><code class="prettyprint">Authorization: bearer {access_token}</code></p>
<h2 id='tui-liu-jian-quan'>推流鉴权</h2>
<p>客户在进行推流前，要先计算推流凭证，作为认证信息拼入推流地址，进行推流。客户利用流信息里的<code class="prettyprint">stream_key</code>，推流次数<code class="prettyprint">push_count</code>和从设备服务器请求到的推流地址，来生成推流凭证。</p>

<p>凭证算法：</p>

<ol>
<li><p>将请求次数递增拼入上推地址</p>

<p>假设当前流的请求次数<code class="prettyprint">push_count</code>为<code class="prettyprint">1</code>（可通过<a href="#cha-xun-liu-xin-xi">查询流信息</a>接口查得），首先将请求次数递增为<code class="prettyprint">2</code>，推流地址为<code class="prettyprint">rtmp://115.238.155.183:49166/livestream/4q5cdgn2</code>，拼接后的推流地址是<code class="prettyprint">rtmp://115.238.155.183:49166/livestream/4q5cdgn2?count=2</code></p>

<p>请求次数务必在每次进行推流请求时都增加，为了保证推流地址不被盗用，已经用过的请求次数将不再接受推流。</p></li>
<li><p>使用<code class="prettyprint">{stream_key}</code>对拼接后的推流地址进行HMAC-SHA1签名</p>

<p><code class="prettyprint">sign = hmac_sha1(&quot;rtmp://115.238.155.183:49166/livestream/4q5cdgn2?count=2&quot;, &quot;{stream_key}&quot;)</code></p></li>
<li><p>对签名进行URL安全的Base64编码，生成<code class="prettyprint">push_token</code></p>

<p><code class="prettyprint">push_token = urlsafe_base64_encode(sign)</code></p></li>
<li><p>推流</p>

<p>之后客户推流时，将推流凭证加入到url地址的query里，实际使用<code class="prettyprint">rtmp://115.238.155.183:49166/livestream/4q5cdgn2?count=2&amp;token={push_token}</code>的请求进行推流。</p></li>
</ol>
<h2 id='bo-fang-jian-quan'>播放鉴权</h2>
<p>播放凭证仅用于<code class="prettyprint">is_private</code>为<code class="prettyprint">true</code>的流的直播和回放。对于<code class="prettyprint">is_private</code>为<code class="prettyprint">false</code>的流，直接使用播放地址就可以播放，不需要凭证。</p>

<p>对于<code class="prettyprint">is_private</code>为<code class="prettyprint">true</code>的流，不管是直播还是回放，客户在进行播放前，要先计算播放凭证，作为认证信息拼入播放地址，进行播放。客户使用自己的<code class="prettyprint">access_key</code>和<code class="prettyprint">secret_key</code>，过期时间戳和从设备服务器请求到的播放地址，来生成播放凭证。</p>

<p><code class="prettyprint">因为有效时间戳的创建和验证在不同的服务端进行（在业务服务器创建，在云服务器验证），因此开发者的业务服务器需要尽可能校准标准时间，否则可能出现凭证刚创建就过期等各种奇怪的问题。</code>
凭证算法：</p>

<ol>
<li><p>将过期时间戳拼入播放地址</p>

<p>假设过期时间戳为<code class="prettyprint">1412122200</code>，播放地址为<code class="prettyprint">http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2.m3u8</code>，拼接后的推流地址是<code class="prettyprint">http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2.m3u8?expiry=1412122200</code></p></li>
<li><p>使用<code class="prettyprint">{secert_key}</code>对拼接后的推流地址进行HMAC-SHA1签名</p>

<p><code class="prettyprint">sign = hmac_sha1(&quot;http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2.m3u8?expiry=1412122200&quot;, &quot;{secert_key}&quot;)</code></p></li>
<li><p>对签名进行URL安全的Base64编码，生成<code class="prettyprint">play_token</code></p>

<p><code class="prettyprint">play_token = urlsafe_base64_encode(sign)</code></p></li>
<li><p>播放</p>

<p>之后客户播放时，将<code class="prettyprint">access_key</code>和播放凭证加入到url地址的query里，实际使用<code class="prettyprint">http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2.m3u8?expiry=1412122200&amp;token={access_key}:{play_token}</code>的请求进行播放。</p></li>
</ol>

          <h1 id='api-she-ji-yuan-ze'>API设计原则</h1>
<ul>
<li>协议</li>
</ul>

<p>API使用HTTPS作为通信协议</p>

<ul>
<li>域名</li>
</ul>

<p>API处在单独的域名下：<code class="prettyprint">https://api.domain.com</code></p>

<ul>
<li>版本</li>
</ul>

<p>API版本号作为HTTP Path的前缀：<code class="prettyprint">https://api.domain.com/v1</code></p>

<ul>
<li>路径</li>
</ul>

<p>每个路径代表一种资源，一般资源都是一个名词，集合或者集合下某个元素：<code class="prettyprint">https://api.domain.com/v1/objects</code>或者<code class="prettyprint">https://api.domain.com/v1/objects/0001</code>。</p>

<p>按照从左到右的顺序，资源应当是依次包含的关系：<code class="prettyprint">https://api.domain.com/v1/bookshelves/1/book/2</code></p>

<p>资源可以包含动作，但是动作不能包含资源：<code class="prettyprint">https://api.domain.com/v1/users/actions/login</code>或者<code class="prettyprint">https://api.domain.com/v1/book/1/actions/delete</code></p>

<ul>
<li>过滤信息</li>
</ul>

<p>一般使用在获取集合类元素的API，用来过滤返回的结果。比如：<code class="prettyprint">?page=2&amp;size=10</code></p>

<ul>
<li>身份认证</li>
</ul>

<p>使用OAuth2框架作为身份认证</p>

<ul>
<li>HTTP动词</li>
</ul>

<p>一般只使用GET和POST两种动词：GET表示获取信息，不修改服务器数据；POST表示修改数据。</p>

<p>还有两个HTTP动词，主要配合浏览器操作：HEAD表示获取资源元信息；OPTIONS表示获取允许的动作。</p>

<ul>
<li>数据格式</li>
</ul>

<p>包括请求时的数据和返回的数据，统一使用JSON格式。</p>

<ul>
<li>状态码</li>
</ul>

<p>一般来说，一个API路径和一个状态码会对应唯一的一种返回结果。</p>

<p>200状态码表示此API调用成功，返回结果因路径而异。对于集合类元素的API，返回结果应包含集合类元素的总数。</p>

<p>202状态码用于异步API调用，表示接受了请求，但还没有处理完成。</p>

<p>204状态码表示API调用成功，但没有返回。</p>

<p>400状态码表示API调用时给出的参数有错误，返回的结果应当描述出具体错误的参数，以及错误原因。</p>

<p>401状态码表示没有调用此API的权限，返回的结果应当有更详细的错误原因。</p>

<p>404状态码表示API调用失败，没有找到所请求的元素。</p>

<p>500状态码表示API调用失败，且错误原因不在调用者，而是服务器内部状态导致的错误，返回的结果应该出错误原因。</p>

<ul>
<li>错误处理</li>
</ul>

<p>对于错误，应当给出更详细的错误原因。一般来说，返回中的<code class="prettyprint">error</code>是统一标示的错误号，用来给用户显示错误信息，有可能信息要做国际化；而返回中的<code class="prettyprint">message</code>是更详细的内部错误原因，用于记录日志，而不给用户显示。</p>

<ul>
<li>Hypermedia API</li>
</ul>

<p>暂不考虑</p>

          <h1 id='yong-hu-jie-kou'>用户接口</h1><h2 id='yong-hu-deng-lu'>用户登录</h2><pre class="highlight shell"><span class="gp">$ </span>curl <span class="s2">"http://api.pili.qiniu.com/v1/_management/users/actions/login"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-X POST <span class="se">\</span>
--data-binary <span class="s1">'{
    "email": "name@domain.com",
    "password": "password"
}'</span>
</pre>

<blockquote>
<p>返回结果</p>
</blockquote>
<pre class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"YTBhNGUyMWQtZmRlYS00YTcwLThkMzAtNGY2MTI1OWU1MjIw"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span><span class="p">,</span><span class="w">
    </span><span class="s2">"refresh_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ZmUyNjA4ODktOGEzMS00NTYyLTgwMDItMDc0MWJmMDBlYjlm"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>
<h2 id='yong-hu-token-shua-xin'>用户token刷新</h2><pre class="highlight shell"><span class="gp">$ </span>curl <span class="s2">"http://api.pili.qiniu.com/v1/_management/users/actions/refresh"</span> <span class="se">\</span>
-H <span class="s2">"Authorization: bearer YTBhNGUyMWQtZmRlYS00YTcwLThkMzAtNGY2MTI1OWU1MjIw"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-X POST <span class="se">\</span>
--data-binary <span class="s1">'{
    "refresh_token": "ZmUyNjA4ODktOGEzMS00NTYyLTgwMDItMDc0MWJmMDBlYjlm"
}'</span>
</pre>

<blockquote>
<p>返回结果</p>
</blockquote>
<pre class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"YTBhNGUyMWQtZmRlYS00YTcwLThkMzAtNGY2MTI1OWU1MjIk"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span><span class="p">,</span><span class="w">
    </span><span class="s2">"refresh_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ZmUyNjA4ODktOGEzMS00NTYyLTgwMDItMDc0MWJmMDBlYjlf"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>
<h2 id='yong-hu-deng-chu'>用户登出</h2><pre class="highlight shell"><span class="gp">$ </span>curl <span class="s2">"http://api.pili.qiniu.com/v1/_management/users/actions/logout"</span> <span class="se">\</span>
-H <span class="s2">"Authorization: bearer YTBhNGUyMWQtZmRlYS00YTcwLThkMzAtNGY2MTI1OWU1MjIw"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-X POST <span class="se">\</span>
--data-binary <span class="s1">'{
    "refresh_token": "ZmUyNjA4ODktOGEzMS00NTYyLTgwMDItMDc0MWJmMDBlYjlf"
}'</span>
</pre>

<blockquote>
<p>无返回结果</p>
</blockquote>

          <h1 id='ying-yong-pei-zhi-jie-kou'>应用配置接口</h1><h2 id='huo-qu-profile-lie-biao'>获取Profile列表</h2><pre class="highlight shell"><span class="gp">$ </span>curl <span class="s2">"http://api.pili.qiniu.com/v1/_management/profiles"</span> <span class="se">\</span>
-H <span class="s2">"Authorization: bearer YTBhNGUyMWQtZmRlYS00YTcwLThkMzAtNGY2MTI1OWU1MjIw"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-X GET
</pre>

<blockquote>
<p>返回结果：</p>
</blockquote>
<pre class="highlight json"><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000002"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1080p"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">1920</span><span class="p">,</span><span class="w">
        </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">1080</span><span class="p">,</span><span class="w">
        </span><span class="s2">"kbitrate"</span><span class="p">:</span><span class="w"> </span><span class="mi">4000</span><span class="p">,</span><span class="w">
        </span><span class="s2">"price_factor"</span><span class="p">:</span><span class="w"> </span><span class="mf">4.0</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000003"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"720p"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">1280</span><span class="p">,</span><span class="w">
        </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">720</span><span class="p">,</span><span class="w">
        </span><span class="s2">"kbitrate"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w">
        </span><span class="s2">"price_factor"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000004"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"480p"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">640</span><span class="p">,</span><span class="w">
        </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">480</span><span class="p">,</span><span class="w">
        </span><span class="s2">"kbitrate"</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w">
        </span><span class="s2">"price_factor"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.25</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></pre>
<h2 id='chuang-jian-ying-yong'>创建应用</h2><pre class="highlight shell"><span class="gp">$ </span>curl <span class="s2">"http://api.pili.qiniu.com/v1/_management/applications"</span> <span class="se">\</span>
-H <span class="s2">"Authorization: bearer YTBhNGUyMWQtZmRlYS00YTcwLThkMzAtNGY2MTI1OWU1MjIw"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-X POST <span class="se">\</span>
--data-binary <span class="s1">'{
    "name": "default",
    "notify_url": "http://client.server/streams/notify",
    "storage_period": -1,
    "has_secondary": true,
    "profiles_id": [
        "54068a9063b906000d000002",
        "54068a9063b906000d000003",
        "54068a9063b906000d000004"
    ]
}'</span>
</pre>

<blockquote>
<p>返回结果</p>
</blockquote>
<pre class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"default"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"notify_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://client.server/streams/notify"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"storage_period"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"has_secondary"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"profiles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000002"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1080p"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">1920</span><span class="p">,</span><span class="w">
            </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">1080</span><span class="p">,</span><span class="w">
            </span><span class="s2">"kbitrate"</span><span class="p">:</span><span class="w"> </span><span class="mi">4000</span><span class="p">,</span><span class="w">
        </span><span class="err">}</span><span class="p">,</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000003"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"720p"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">1280</span><span class="p">,</span><span class="w">
            </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">720</span><span class="p">,</span><span class="w">
            </span><span class="s2">"kbitrate"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w">
        </span><span class="err">}</span><span class="p">,</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000004"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"480p"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">640</span><span class="p">,</span><span class="w">
            </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">480</span><span class="p">,</span><span class="w">
            </span><span class="s2">"kbitrate"</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w">
        </span><span class="err">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"key"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"access"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xx"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"secret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"yy"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>
<h2 id='cha-xun-ying-yong-lie-biao'>查询应用列表</h2><pre class="highlight shell"><span class="gp">$ </span>curl <span class="s2">"http://api.pili.qiniu.com/v1/_management/applications?page=1&amp;size=10"</span> <span class="se">\</span>
-H <span class="s2">"Authorization: bearer YTBhNGUyMWQtZmRlYS00YTcwLThkMzAtNGY2MTI1OWU1MjIw"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-X GET
</pre>

<blockquote>
<p>返回结果</p>
</blockquote>
<pre class="highlight json"><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"app1"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"notify_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://client.server/streams/notify"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"storage_period"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
        </span><span class="s2">"has_secondary"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="s2">"profiles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000002"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1080p"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">1920</span><span class="p">,</span><span class="w">
                </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">1080</span><span class="p">,</span><span class="w">
                </span><span class="s2">"kbitrate"</span><span class="p">:</span><span class="w"> </span><span class="mi">4000</span><span class="p">,</span><span class="w">
            </span><span class="err">}</span><span class="p">,</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000003"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"720p"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">1280</span><span class="p">,</span><span class="w">
                </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">720</span><span class="p">,</span><span class="w">
                </span><span class="s2">"kbitrate"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w">
            </span><span class="err">}</span><span class="p">,</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000004"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"480p"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">640</span><span class="p">,</span><span class="w">
                </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">480</span><span class="p">,</span><span class="w">
                </span><span class="s2">"kbitrate"</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w">
            </span><span class="err">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"key"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"access"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xx"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"secret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"yy"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"app2"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"notify_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://client.server/streams/notify"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"storage_period"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
        </span><span class="s2">"has_secondary"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="s2">"profiles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000002"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1080p"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">1920</span><span class="p">,</span><span class="w">
                </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">1080</span><span class="p">,</span><span class="w">
                </span><span class="s2">"kbitrate"</span><span class="p">:</span><span class="w"> </span><span class="mi">4000</span><span class="p">,</span><span class="w">
            </span><span class="err">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"key"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"access"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xx"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"secret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"yy"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></pre>
<h2 id='cha-xun-ying-yong-xi-jie'>查询应用细节</h2><pre class="highlight shell"><span class="gp">$ </span>curl <span class="s2">"http://api.pili.qiniu.com/v1/_management/applications/app"</span> <span class="se">\</span>
-H <span class="s2">"Authorization: bearer YTBhNGUyMWQtZmRlYS00YTcwLThkMzAtNGY2MTI1OWU1MjIw"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-X GET
</pre>

<blockquote>
<p>返回结果</p>
</blockquote>
<pre class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"default"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"notify_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://client.server/streams/notify"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"storage_period"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"has_secondary"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"profiles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000002"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1080p"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">1920</span><span class="p">,</span><span class="w">
            </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">1080</span><span class="p">,</span><span class="w">
            </span><span class="s2">"kbitrate"</span><span class="p">:</span><span class="w"> </span><span class="mi">4000</span><span class="p">,</span><span class="w">
        </span><span class="err">}</span><span class="p">,</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000003"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"720p"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">1280</span><span class="p">,</span><span class="w">
            </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">720</span><span class="p">,</span><span class="w">
            </span><span class="s2">"kbitrate"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w">
        </span><span class="err">}</span><span class="p">,</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000004"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"480p"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">640</span><span class="p">,</span><span class="w">
            </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">480</span><span class="p">,</span><span class="w">
            </span><span class="s2">"kbitrate"</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w">
        </span><span class="err">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"key"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"access"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xx"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"secret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"yy"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>
<h2 id='shan-chu-ying-yong'>删除应用</h2><pre class="highlight shell"><span class="gp">$ </span>curl <span class="s2">"http://api.pili.qiniu.com/v1/_management/applications/app"</span> <span class="se">\</span>
-H <span class="s2">"Authorization: bearer YTBhNGUyMWQtZmRlYS00YTcwLThkMzAtNGY2MTI1OWU1MjIw"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-X DELETE
</pre>

<blockquote>
<p>返回结果</p>
</blockquote>
<pre class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"default"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"notify_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://client.server/streams/notify"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"storage_period"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"has_secondary"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"profiles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000002"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1080p"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">1920</span><span class="p">,</span><span class="w">
            </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">1080</span><span class="p">,</span><span class="w">
            </span><span class="s2">"kbitrate"</span><span class="p">:</span><span class="w"> </span><span class="mi">4000</span><span class="p">,</span><span class="w">
        </span><span class="err">}</span><span class="p">,</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000003"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"720p"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">1280</span><span class="p">,</span><span class="w">
            </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">720</span><span class="p">,</span><span class="w">
            </span><span class="s2">"kbitrate"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w">
        </span><span class="err">}</span><span class="p">,</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000004"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"480p"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">640</span><span class="p">,</span><span class="w">
            </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">480</span><span class="p">,</span><span class="w">
            </span><span class="s2">"kbitrate"</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w">
        </span><span class="err">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"key"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"access"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xx"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"secret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"yy"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>
<h2 id='tong-zhi-jie-kou'>通知接口</h2><pre class="highlight shell"><span class="gp">$ </span>curl <span class="s2">"http://client.server/streams/notify"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-X POST
--binary-data <span class="s1">'{
    "cmd": "status",
    "data": {
        "status": "connected" // connected, disconnected
    }
}'</span>
</pre>
<pre class="highlight shell"><span class="gp">$ </span>curl <span class="s2">"http://client.server/streams/notify"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-X POST
--binary-data <span class="s1">'{
    "cmd": "mark",
    "data": {
        "id": 1234,
        "status": "pushed" // pushed, converted, downloaded, played
    }
}'</span>
</pre>

<blockquote>
<p>返回结果</p>
</blockquote>
<pre class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

          <h1 id='liu-guan-li-jie-kou'>流管理接口</h1><h2 id='chuang-jian-liu'>创建流</h2><pre class="highlight shell"><span class="gp">$ </span>curl <span class="s2">"http://api.pili.qiniu.com/v1/streams"</span> <span class="se">\</span>
-H <span class="s2">"Authorization: pili {access_key}:{encoded_sign}"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-X POST <span class="se">\</span>
--data-binary <span class="s1">'{
    "application": "app_name",
    "stream_key": "random_stream_key",
    "is_private": false,
}'</span>
</pre>

<blockquote>
<p>返回结果：</p>
</blockquote>
<pre class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000001"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"application"</span><span class="p">:</span><span class="w"> </span><span class="s2">"app_name"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"stream_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"random_stream_key"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"is_private"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"push_url"</span><span class="p">:[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://pili-in.qiniu.com/livestream/4q5cdgn2_primary"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"PFSP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pfsp://pili-in.qiniu.com/4q5cdgn2_primary"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://pili-in.qiniu.com/livestream/4q5cdgn2_secondary"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"PFSP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pfsp://pili-in.qiniu.com/4q5cdgn2_secondary"</span><span class="w">
        </span><span class="p">},</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"live_url"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"*"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2.m3u8"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2"</span><span class="w">
        </span><span class="p">}</span><span class="w">
        </span><span class="s2">"1080p"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_1080p.m3u8"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_1080p"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"720p"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_720p.m3u8"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_720p"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"480p"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_480p.m3u8"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_480p"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>此接口返回注册后的流id和推流地址。</p>
<h3 id='http-qing-qiu'>HTTP请求</h3>
<p><code class="prettyprint">POST /v1/streams</code></p>
<h3 id='ren-zheng-fang-fa'>认证方法</h3>
<p>使用<a href="#jie-kou-jian-quan">接口鉴权</a>进行认证</p>

<p><code class="prettyprint">Authorization: pili {access_key}:{encoded_sign}</code></p>
<h3 id='qing-qiu-can-shu'>请求参数</h3>
<table><thead>
<tr>
<th>参数</th>
<th>描述</th>
<th>是否可选</th>
</tr>
</thead><tbody>
<tr>
<td>application</td>
<td>所属于的应用名字</td>
<td>必选</td>
</tr>
<tr>
<td>stream_key</td>
<td>由设备生成的字符串，标示设备，可以使用设备的Qiniu地址或者随机生成一个字符串</td>
<td>可选，如果不指定，则服务器会随机生成一串stream_key</td>
</tr>
<tr>
<td>is_private</td>
<td>是否为私有流。如果值为true，播放时（直播和点播）需要有<a href="#bo-fang-jian-quan">播放鉴权</a>，值为false时，直接是用播放url播放即可</td>
<td>可选，默认为false</td>
</tr>
<tr>
<td>protocol</td>
<td>视频推流协议</td>
<td>必选</td>
</tr>
</tbody></table>

<table><thead>
<tr>
<th>协议名</th>
<th>协议</th>
</tr>
</thead><tbody>
<tr>
<td>RTMP</td>
<td>Adobe Flash定义的实时多媒体流传输协议</td>
</tr>
<tr>
<td>PRTP</td>
<td>Pili定义的udp加速技术的TS传输协议</td>
</tr>
<tr>
<td>PTTP</td>
<td>基于tcp的TS传输协议</td>
</tr>
<tr>
<td>HLS</td>
<td>Apple定义的多媒体流传输协议</td>
</tr>
</tbody></table>
<h2 id='cha-xun-liu-xin-xi'>查询流信息</h2><pre class="highlight shell"><span class="gp">$ </span>curl <span class="s2">"http://api.pili.qiniu.com/v1/streams/54068a9063b906000d000001"</span> <span class="se">\</span>
-H <span class="s2">"Authorization: pili {access_key}:{encoded_sign}"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-X GET
</pre>

<blockquote>
<p>返回结果：</p>
</blockquote>
<pre class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000001"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"application"</span><span class="p">:</span><span class="w"> </span><span class="s2">"app_name"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"stream_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"random_stream_key"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"is_private"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"push_url"</span><span class="p">:[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://pili-in.qiniu.com/livestream/4q5cdgn2_primary"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"PFSP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pfsp://pili-in.qiniu.com/4q5cdgn2_primary"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://pili-in.qiniu.com/livestream/4q5cdgn2_secondary"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"PFSP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pfsp://pili-in.qiniu.com/4q5cdgn2_secondary"</span><span class="w">
        </span><span class="p">},</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"live_url"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"*"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2.m3u8"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2"</span><span class="w">
        </span><span class="p">}</span><span class="w">
        </span><span class="s2">"1080p"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_1080p.m3u8"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_1080p"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"720p"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_720p.m3u8"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_720p"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"480p"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_480p.m3u8"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_480p"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>
<h3 id='http-qing-qiu'>HTTP请求</h3>
<p><code class="prettyprint">GET /v1/streams/{id}</code></p>
<h3 id='ren-zheng-fang-fa'>认证方法</h3>
<p>使用<a href="#jie-kou-jian-quan">接口鉴权</a>进行认证</p>

<p><code class="prettyprint">Authorization: pili {access_key}:{encoded_sign}</code></p>
<h2 id='huo-qu-liu-lie-biao'>获取流列表</h2><pre class="highlight shell"><span class="gp">$ </span>curl <span class="s2">"http://api.pili.qiniu.com/v1/streams?page=1&amp;size=10"</span> <span class="se">\</span>
-H <span class="s2">"Authorization: pili {access_key}:{encoded_sign}"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-X GET
</pre>

<blockquote>
<p>返回结果：</p>
</blockquote>
<pre class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="s2">"streams"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000001"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"application"</span><span class="p">:</span><span class="w"> </span><span class="s2">"app_name"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"stream_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"random_stream_key"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"is_private"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="s2">"push_url"</span><span class="p">:[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://pili-in.qiniu.com/livestream/4q5cdgn2_primary"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"PFSP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pfsp://pili-in.qiniu.com/4q5cdgn2_primary"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://pili-in.qiniu.com/livestream/4q5cdgn2_secondary"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"PFSP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pfsp://pili-in.qiniu.com/4q5cdgn2_secondary"</span><span class="w">
                </span><span class="p">},</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="s2">"live_url"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"*"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2.m3u8"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2"</span><span class="w">
                </span><span class="p">}</span><span class="w">
                </span><span class="s2">"1080p"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_1080p.m3u8"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_1080p"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">"720p"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_720p.m3u8"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_720p"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">"480p"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_480p.m3u8"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_480p"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000002"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"application"</span><span class="p">:</span><span class="w"> </span><span class="s2">"app_name"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"stream_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"random_stream_key"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"is_private"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="s2">"push_url"</span><span class="p">:[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://pili-in.qiniu.com/livestream/4q5cdgn2_primary"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"PFSP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pfsp://pili-in.qiniu.com/4q5cdgn2_primary"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://pili-in.qiniu.com/livestream/4q5cdgn2_secondary"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"PFSP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pfsp://pili-in.qiniu.com/4q5cdgn2_secondary"</span><span class="w">
                </span><span class="p">},</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="s2">"live_url"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"*"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2.m3u8"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2"</span><span class="w">
                </span><span class="p">}</span><span class="w">
                </span><span class="s2">"1080p"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_1080p.m3u8"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_1080p"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">"720p"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_720p.m3u8"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_720p"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">"480p"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_480p.m3u8"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_480p"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000003"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"application"</span><span class="p">:</span><span class="w"> </span><span class="s2">"app_name"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"stream_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"random_stream_key"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"is_private"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="s2">"push_url"</span><span class="p">:[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://pili-in.qiniu.com/livestream/4q5cdgn2_primary"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"PFSP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pfsp://pili-in.qiniu.com/4q5cdgn2_primary"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://pili-in.qiniu.com/livestream/4q5cdgn2_secondary"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"PFSP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pfsp://pili-in.qiniu.com/4q5cdgn2_secondary"</span><span class="w">
                </span><span class="p">},</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="s2">"live_url"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"*"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2.m3u8"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2"</span><span class="w">
                </span><span class="p">}</span><span class="w">
                </span><span class="s2">"1080p"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_1080p.m3u8"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_1080p"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">"720p"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_720p.m3u8"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_720p"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="s2">"480p"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_480p.m3u8"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_480p"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>此接口返回对应用户创建的所有流的id以及流的连接状态。</p>
<h3 id='http-qing-qiu'>HTTP请求</h3>
<p><code class="prettyprint">GET /v1/streams</code></p>
<h3 id='ren-zheng-fang-fa'>认证方法</h3>
<p>使用<a href="#jie-kou-jian-quan">接口鉴权</a>进行认证</p>

<p><code class="prettyprint">Authorization: pili {access_key}:{encoded_sign}</code></p>
<h3 id='qing-qiu-can-shu'>请求参数</h3>
<table><thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>page</td>
<td>显示第几页，默认为第1页</td>
</tr>
<tr>
<td>size</td>
<td>一页大小多大，默认为10，最大100</td>
</tr>
</tbody></table>
<h2 id='geng-xin-liu'>更新流</h2><pre class="highlight shell"><span class="gp">$ </span>curl <span class="s2">"http://api.pili.qiniu.com/v1/streams/54068a9063b906000d000001"</span> <span class="se">\</span>
-H <span class="s2">"Authorization: pili {access_key}:{encoded_sign}"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-X POST <span class="se">\</span>
--data-binary <span class="s1">'{
    "stream_key": "random_stream_key",
    "is_private": false,
}'</span>
</pre>

<blockquote>
<p>返回结果：</p>
</blockquote>
<pre class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000001"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"application"</span><span class="p">:</span><span class="w"> </span><span class="s2">"app_name"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"stream_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"random_stream_key"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"is_private"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"push_url"</span><span class="p">:[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://pili-in.qiniu.com/livestream/4q5cdgn2_primary"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"PFSP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pfsp://pili-in.qiniu.com/4q5cdgn2_primary"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://pili-in.qiniu.com/livestream/4q5cdgn2_secondary"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"PFSP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pfsp://pili-in.qiniu.com/4q5cdgn2_secondary"</span><span class="w">
        </span><span class="p">},</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"live_url"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"*"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2.m3u8"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2"</span><span class="w">
        </span><span class="p">}</span><span class="w">
        </span><span class="s2">"1080p"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_1080p.m3u8"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_1080p"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"720p"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_720p.m3u8"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_720p"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"480p"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_480p.m3u8"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_480p"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>此接口更新流的推流地址。</p>
<h3 id='http-qing-qiu'>HTTP请求</h3>
<p><code class="prettyprint">POST /v1/streams/{id}</code></p>
<h3 id='ren-zheng-fang-fa'>认证方法</h3>
<p>使用<a href="#jie-kou-jian-quan">接口鉴权</a>进行认证</p>

<p><code class="prettyprint">Authorization: pili {access_key}:{encoded_sign}</code></p>
<h3 id='qing-qiu-can-shu'>请求参数</h3>
<table><thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>stream_key</td>
<td>由设备生成的字符串，标示设备，可以使用设备的Qiniu地址或者随机生成一个字符串</td>
</tr>
<tr>
<td>is_private</td>
<td>是否为私有流。如果值为true，播放时（直播和点播）需要有<a href="#bo-fang-jian-quan">播放鉴权</a>，值为false时，直接是用播放url播放即可</td>
</tr>
<tr>
<td>protocol</td>
<td>视频推流协议</td>
</tr>
</tbody></table>
<h2 id='shan-chu-liu'>删除流</h2><pre class="highlight shell"><span class="gp">$ </span>curl <span class="s2">"http://api.pili.qiniu.com/v1/streams/54068a9063b906000d000001"</span> <span class="se">\</span>
-H <span class="s2">"Authorization: pili {access_key}:{encoded_sign}"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-X DELETE
</pre>

<blockquote>
<p>返回结果：</p>
</blockquote>
<pre class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54068a9063b906000d000001"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"application"</span><span class="p">:</span><span class="w"> </span><span class="s2">"app_name"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"stream_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"random_stream_key"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"is_private"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"push_url"</span><span class="p">:[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://pili-in.qiniu.com/livestream/4q5cdgn2_primary"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"PFSP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pfsp://pili-in.qiniu.com/4q5cdgn2_primary"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://pili-in.qiniu.com/livestream/4q5cdgn2_secondary"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"PFSP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pfsp://pili-in.qiniu.com/4q5cdgn2_secondary"</span><span class="w">
        </span><span class="p">},</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"live_url"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"*"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2.m3u8"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2"</span><span class="w">
        </span><span class="p">}</span><span class="w">
        </span><span class="s2">"1080p"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_1080p.m3u8"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_1080p"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"720p"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_720p.m3u8"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_720p"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"480p"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"HLS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn-ts.qbox.me/api/v1/hls/4q5cdgn2_480p.m3u8"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"RTMP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rtmp://cdn-rtmp.qbox.me/livestream/4q5cdgn2_480p"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>
<h3 id='http-qing-qiu'>HTTP请求</h3>
<p><code class="prettyprint">DELETE /v1/streams/{id}</code></p>
<h3 id='ren-zheng-fang-fa'>认证方法</h3>
<p>使用<a href="#jie-kou-jian-quan">接口鉴权</a>进行认证</p>

<p><code class="prettyprint">Authorization: pili {access_key}:{encoded_sign}</code></p>
<h3 id='qing-qiu-can-shu'>请求参数</h3>
<p>无</p>
<h2 id='liu-zhuang-tai-tui-song-jie-kou'>流状态推送接口</h2><pre class="highlight shell"><span class="gp">$ </span>curl <span class="s2">"http://api.pili.qiniu.com/v1/streams/54068a9063b906000d000001/status"</span> <span class="se">\</span>
-H <span class="s2">"Authorization: pili {access_key}:{encoded_sign}"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-X GET
</pre>

<blockquote>
<p>返回结果：</p>
</blockquote>
<pre class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"disconnected"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>
<h3 id='http-qing-qiu'>HTTP请求</h3>
<p><code class="prettyprint">GET /v1/streams/{id}/status</code></p>
<h3 id='ren-zheng-fang-fa'>认证方法</h3>
<p>使用<a href="#jie-kou-jian-quan">接口鉴权</a>进行认证</p>

<p><code class="prettyprint">Authorization: pili {access_key}:{encoded_sign}</code></p>
<h3 id='qing-qiu-can-shu'>请求参数</h3>
<table><thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>status</td>
<td>connected表示正在推流，disconnected表示没有推流</td>
</tr>
</tbody></table>
<h2 id='huo-qu-hui-fang-pian-duan-lie-biao'>获取回放片段列表</h2><pre class="highlight shell"><span class="gp">$ </span>curl <span class="s2">"http://api.pili.qiniu.com/v1/streams/54068a9063b906000d000001/segments?starttime=1409926345158&amp;endtime=1409932087561"</span> <span class="se">\</span>
-H <span class="s2">"Authorization: pili {access_key}:{encoded_sign}"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-X GET
</pre>

<blockquote>
<p>返回结果：</p>
</blockquote>
<pre class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="s2">"list"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"starttime"</span><span class="p">:</span><span class="w"> </span><span class="mi">1409926345158</span><span class="p">,</span><span class="w">
            </span><span class="s2">"endtime"</span><span class="p">:</span><span class="w"> </span><span class="mi">1409926837567</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"starttime"</span><span class="p">:</span><span class="w"> </span><span class="mi">1409929883546</span><span class="p">,</span><span class="w">
            </span><span class="s2">"endtime"</span><span class="p">:</span><span class="w"> </span><span class="mi">1409932087561</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>本接口返回回放片段列表。列表的起始结束时间为unix timestamp，精确到millisecond。</p>
<h3 id='http-qing-qiu'>HTTP请求</h3>
<p><code class="prettyprint">GET /v1/streams/{id}/segments?starttime={starttime}&amp;endtime={endtime}</code></p>
<h3 id='ren-zheng-fang-fa'>认证方法</h3>
<p>使用<a href="#jie-kou-jian-quan">接口鉴权</a>进行认证</p>

<p><code class="prettyprint">Authorization: pili {access_key}:{encoded_sign}</code></p>
<h3 id='qing-qiu-can-shu'>请求参数</h3>
<table><thead>
<tr>
<th>参数</th>
<th>描述</th>
<th>是否可选</th>
<th>类型</th>
</tr>
</thead><tbody>
<tr>
<td>starttime</td>
<td>列表开始时间</td>
<td>可选</td>
<td>millisecond unix timestamp</td>
</tr>
<tr>
<td>endtime</td>
<td>列表结束时间</td>
<td>可选</td>
<td>millisecond unix timestamp</td>
</tr>
</tbody></table>
<h2 id='huo-qu-hui-fang-pian-duan-di-zhi'>获取回放片段地址</h2><pre class="highlight shell"><span class="gp">$ </span>curl <span class="s2">"http://api.pili.qiniu.com/v1/streams/54068a9063b906000d000001/segments/play?starttime=1409926345158"</span> <span class="se">\</span>
-H <span class="s2">"Authorization: pili {access_key}:{encoded_sign}"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-X GET
</pre>

<blockquote>
<p>返回结果：</p>
</blockquote>
<pre class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://115.238.155.183:49166/livestream/jnl617jk.m3u8"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>此接口获取回放片段的播放地址</p>
<h3 id='http-qing-qiu'>HTTP请求</h3>
<p><code class="prettyprint">GET /v1/streams/{id}/segments/play?starttime={starttime}&amp;endtime={endtime}</code></p>
<h3 id='ren-zheng-fang-fa'>认证方法</h3>
<p>使用<a href="#jie-kou-jian-quan">接口鉴权</a>进行认证</p>

<p><code class="prettyprint">Authorization: pili {access_key}:{encoded_sign}</code></p>
<h3 id='qing-qiu-can-shu'>请求参数</h3>
<table><thead>
<tr>
<th>参数</th>
<th>描述</th>
<th>是否可选</th>
<th>类型</th>
</tr>
</thead><tbody>
<tr>
<td>starttime</td>
<td>开始时间</td>
<td>必选</td>
<td>millisecond unix timestamp</td>
</tr>
<tr>
<td>endtime</td>
<td>结束时间</td>
<td>可选</td>
<td>millisecond unix timestamp</td>
</tr>
</tbody></table>
<h2 id='shan-chu-pian-duan'>删除片段</h2><pre class="highlight shell"><span class="gp">$ </span>curl <span class="s2">"http://api.pili.qiniu.com/v1/streams/54068a9063b906000d000001/segments?starttime=1409926345158&amp;endtime=1409932087561"</span> <span class="se">\</span>
-H <span class="s2">"Authorization: pili {access_key}:{encoded_sign}"</span> <span class="se">\</span>
-H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
-X DELETE
</pre>

<blockquote>
<p>返回结果为空</p>
</blockquote>

<p>此接口删除指定时间内的回放片段。</p>
<h3 id='http-qing-qiu'>HTTP请求</h3>
<p><code class="prettyprint">DELETE /v1/streams/{id}/segments?starttime={starttime}&amp;endtime={endtime}</code></p>
<h3 id='ren-zheng-fang-fa'>认证方法</h3>
<p>使用<a href="#jie-kou-jian-quan">接口鉴权</a>进行认证</p>

<p><code class="prettyprint">Authorization: pili {access_key}:{encoded_sign}</code></p>
<h3 id='qing-qiu-can-shu'>请求参数</h3>
<table><thead>
<tr>
<th>参数</th>
<th>描述</th>
<th>是否可选</th>
<th>类型</th>
</tr>
</thead><tbody>
<tr>
<td>starttime</td>
<td>开始时间</td>
<td>必选</td>
<td>millisecond unix timestamp</td>
</tr>
<tr>
<td>endtime</td>
<td>结束时间</td>
<td>必选</td>
<td>millisecond unix timestamp</td>
</tr>
</tbody></table>

          <h1 id='jie-kou-fan-hui'>接口返回</h1>
<p>接口输入和输出都是用JSON格式。不同的返回码对应不同的格式。</p>
<h2 id='200'>200</h2>
<p>返回格式参见不同接口的文档</p>
<h2 id='204'>204</h2>
<p>无返回内容</p>
<h2 id='400'>400</h2><pre class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="mi">400000</span><span class="p">,</span><span class="w">
    </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bad request"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"field1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="mi">400001</span><span class="p">,</span><span class="w">
            </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid string"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"field2"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="mi">400004</span><span class="p">,</span><span class="w">
            </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid bool"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p><code class="prettyprint">error</code>为唯一的错误标示码，客户端根据标示码来决定向用户输出的错误信息。<code class="prettyprint">message</code>主要用于客户端记录log，最好不用于输出。｀details`用于记录请求中具体某个字段的错误原因。</p>

<table><thead>
<tr>
<th>message</th>
<th>error</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>invalid json</td>
<td>400000</td>
<td>输入请求不符合json语法</td>
</tr>
<tr>
<td>invalid string</td>
<td>400001</td>
<td>输入格式不是字符串</td>
</tr>
<tr>
<td>string should NOT empty</td>
<td>400002</td>
<td>字符串不应为空</td>
</tr>
<tr>
<td>invalid number</td>
<td>400003</td>
<td>输入格式不是有效数字</td>
</tr>
<tr>
<td>invalid bool</td>
<td>400004</td>
<td>输入格式不是布尔型</td>
</tr>
<tr>
<td>need protocol</td>
<td>400011</td>
<td>需要给出protocol参数</td>
</tr>
<tr>
<td>invalid protocol</td>
<td>400012</td>
<td>无效的protocol参数</td>
</tr>
<tr>
<td>need starttime</td>
<td>400013</td>
<td>需要给出starttime参数</td>
</tr>
<tr>
<td>need endtime</td>
<td>400014</td>
<td>需要给出endtime参数</td>
</tr>
</tbody></table>
<h2 id='401-404-500'>401/404/500</h2><pre class="highlight json"><span class="p">{</span><span class="w">
    </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="mi">401001</span><span class="p">,</span><span class="w">
    </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid authorization"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p><code class="prettyprint">error</code>为唯一的错误标示码，客户端根据标示码来决定向用户输出的错误信息。<code class="prettyprint">message</code>主要用于客户端记录log，最好不用于输出。</p>

<table><thead>
<tr>
<th>http code</th>
<th>message</th>
<th>error</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>401</td>
<td>invalid authorization</td>
<td>401001</td>
<td>无效的鉴权方式</td>
</tr>
<tr>
<td>403</td>
<td>token is invalid or has been expired</td>
<td>403001</td>
<td>token无效或者已经过期</td>
</tr>
<tr>
<td>404</td>
<td>not found</td>
<td>404001</td>
<td>找不到要操作的资源</td>
</tr>
<tr>
<td>500</td>
<td></td>
<td>500000</td>
<td>服务内部错误，message为细节错误，用于记录log</td>
</tr>
</tbody></table>

      </div>

      <div class="dark-box"></div>
    </div>

  </body>
</html>
